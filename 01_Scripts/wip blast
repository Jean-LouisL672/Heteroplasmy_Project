
from Bio.Blast import NCBIXML
#NCBIXML pour extraire les infoemation du fichier result_blast.xml

BLAST_DIR_OUTPUT="/data/projet2/02_Phylogeny_part/mitochondrion/blast_output/"
seq = []#seq qui va etre blast a choisir consensus mytochondrie
SeqIO.write(seq,'/data/projet2/02_Phylogeny_part/fasta_files/prot.fasta', 'fasta')
prot_fasta="/data/projet2/02_Phylogeny_part/fasta_files/prot.fasta"
#fonction blaste qui met les resultat du blaste dans le fichier result_blast.xml
#accession_name_cible = nom genome cible sur lequel on fait le blaste

def blast_prot(accession_name_cible):
    SeqIO.write(seq,'prot.fasta', 'fasta')
    blast = "/data/projet2/Blast+/linux/"  #peut etre le mettre en dehors de la fonction 
    cible=  f"/data/projet2/02_Phylogeny_part/mitochondrion/{accession_name_cible}"
    cmd_line = [blast, "-query", prot_fasta, "-db", cible,
            "-evalue", "0.001", "-out", BLAST_DIR_OUTPUT + "result_blast.xml", "-outfmt", "5"]
    
    subprocess.run(cmd_line)




#pour recuperer l'id des hit du blast on met juste le chemin du fichier result_blast.xml qu'on veut extraire
# sauf qu'on change l'extraction d'id par l'extraction de "Hsp_query-to" du result_blast.xml a faire

def hit_id(chemin_blaste):
    with open(chemin_blaste, 'r') as result_file:
        records = NCBIXML.parse(result_file)
        # Parcourir les BLAST
        for blast_record in records:
            # Parcourir les alignements BLAST dans l'enregistrement
            for alignment in blast_record.alignments[:1]:
                # Extraire l'identifiant entre les caractères "|" sinon on a "ref|id prot|" et ça ne marche pas pour ensuite
                hit_id = next(iter(alignment.hit_id.split('|')[1:]), '')
                return hit_id


#ecrir une fonction qui prend la sequance d'un fasta, met en chaine, coupe la partie de zero a hit to query et le colle 
# a la fin